---
apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: {{ .Release.Name }}
spec:
  entrypoint: only-entrypoint
  synchronization:
    semaphore:
      configMapKeyRef:
        name: sync-cm
        key: mutex
  templates:
  - name: only-entrypoint
    container:
      name: {{ .Release.Name }}
      command: ["python"]
      args: ["main.py"]
      image: {{ include "server.image" . }}
      imagePullPolicy: {{ .Values.image.pullPolicy }}
      ports:
        - containerPort: 80
          name: http-web-svc-port
      env:
        - name: PYTHONUNBUFFERED
          value: "1"
    imagePullSecrets:
    - name: gcr-json-key
